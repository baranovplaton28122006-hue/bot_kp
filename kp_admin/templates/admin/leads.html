
{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="mb-0">Лиды</h4>
  <a class="btn btn-success" href="{{ url_for('routes.lead_new') }}">Новый лид</a>
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col">
    <input class="form-control" type="search" name="q" placeholder="Поиск по компании, имени, email, телефону" value="{{ q }}">
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-success" type="submit">Найти</button>
  </div>
</form>

<form method="post" action="{{ url_for('routes.bulk_delete') }}">
<table class="table table-hover align-middle">
  <thead>
    <tr>
      <th style="width:32px;"><input type="checkbox" onclick="document.querySelectorAll('input[name=ids]').forEach(cb=>cb.checked=this.checked)"></th>
      <th>ID</th>
      <th>Компания / Имя</th>
      <th>Email</th>
      <th>Телефон</th>
      <th>Создан</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for l in items %}
    <tr>
      <td><input type="checkbox" name="ids" value="{{ l.id }}"></td>
      <td>{{ l.id }}</td>
      <td>{{ l.company or l.contact_name or "-" }}</td>
      <td>{{ l.email or "-" }}</td>
      <td>{{ l.phone or "-" }}</td>
      <td>{{ l.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
      <td class="text-end">
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('routes.lead_detail', lead_id=l.id) }}">Открыть</a>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="7" class="text-center text-muted">Ничего не найдено</td></tr>
    {% endfor %}
  </tbody>
</table>

<div class="d-flex justify-content-between align-items-center">
  <div>
    <button class="btn btn-outline-danger btn-sm" type="submit">Удалить выбранные</button>
  </div>
  <nav>
    <ul class="pagination mb-0">
      {% for p in range(1, pages+1) %}
      <li class="page-item {% if p==page %}active{% endif %}">
        <a class="page-link" href="?page={{ p }}&q={{ q|urlencode }}">{{ p }}</a>
      </li>
      {% endfor %}
    </ul>
  </nav>
</div>
</form>
{% endblock %}
